import { Tabs, Callout } from 'nextra/components';

# Hello World API è°ƒç”¨

åœ¨ [ä¸Šä¸€æ­¥](./hello-world-api)ï¼Œæˆ‘ä»¬å·²å°† API å†™å¥½ï¼Œå¹¶ä¸”å°†æ¨¡å—å¯¼å‡ºåˆ° **./fe-sdk** æ–‡ä»¶å¤¹ã€‚

æ¥ä¸‹æ¥ï¼š

- åˆ›å»ºå‰ç«¯é¡¹ç›®
- è®¾ç½® monorepo
- è°ƒç”¨ `fe-sdk` æ¨¡å—ï¼Œè°ƒç”¨ç›¸å…³æ¥å£

### åˆ›å»ºå‰ç«¯é¡¹ç›®

æˆ‘ä»¬å¯ä»¥åœ¨å½“å‰é¡¹ç›®å†åˆ›å»ºä¸€ä¸ªå‰ç«¯åº”ç”¨ï¼Œè¿™é‡Œæ‹¿ **next.js** ä¸¾ä¾‹å­åˆ›å»º `next-app` åº”ç”¨

<Tabs defaultIndex="1" items={['npm', 'pnpm']}>
  <Tabs.Tab value="npm">

```sh
npx create-next-app@latest
```

  </Tabs.Tab>
  <Tabs.Tab value="pnpm">

```zsh
pnpx create-next-app@latest
```

  </Tabs.Tab>
</Tabs>

æŒ‰ç…§æç¤ºå®Œæˆé¡¹ç›®é…ç½®ï¼Œ**é¡¹ç›®åç§°æ˜¯ `next-app`**ã€‚

### è®¾ç½® workspaceï¼ˆmonorepoï¼‰

åˆ›å»ºå®Œå‰ç«¯é¡¹ç›®åï¼Œå†å°† `./fe-sdk` æ¨¡å—æ·»åŠ åˆ°åˆ›å»ºå¥½çš„å‰ç«¯é¡¹ç›®é‡Œçš„ **package.json**:

<Callout>
  è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ [pnpm workspace](https://pnpm.io/workspaces)ï¼› å¦‚æœä½¿ç”¨ npm æˆ–è€… yarnï¼Œè¯·å‚è€ƒç›¸å¯¹åº”çš„ workspace æ–¹æ¡ˆã€‚
</Callout>

```json {4-6, 10}
{
  ...
  "dependencies": {
    "fe-sdk": "workspace:*",
    "axios": "1.7.7",
    "http-proxy": "1.18.1",
    ...
  },
  "devDependencies": {
    "@types/http-proxy": "^1.17.14",
    ...
  }
  ...
}
```

### è°ƒç”¨ `fe-sdk`

å…ˆå®‰è£…ä¾èµ–ï¼š

```sh
pnpm i
```

#### åˆ›å»ºé…ç½®æ–‡ä»¶ **.env**

```ts filename="next-app/.env" copy
API_URL=http://localhost:3030
```

#### åˆ›å»º API Proxy

```ts filename="pages/api/[...path].ts" copy
import { IncomingMessage, ServerResponse } from 'http';
import httpProxy from 'http-proxy';

const API_URL = process.env.API_URL;

const proxy = httpProxy.createProxyServer();

export const config = {
  api: {
    bodyParser: false,
  },
};

export default function api(req: IncomingMessage, res: ServerResponse<IncomingMessage>) {
  return new Promise((resolve, reject) => {
    proxy.web(
      req,
      res,
      {
        target: API_URL,
        changeOrigin: true,
      },
      (err) => {
        if (err) {
          return reject(err);
        } else {
          resolve(1);
        }
      }
    );
  });
}
```

#### åˆ›å»º **lib/user-api.ts**

åœ¨ `next-app` é‡Œåˆ›å»º **lib/user-api.ts**ï¼š

```ts filename="next-app/lib/user-api.ts" copy
import axios, { AxiosError } from 'axios';
import { setHandler, setAxiosInstance, axiosHandler } from 'fe-sdk';

export * from 'fe-sdk/lib/user-api';
export * from 'fe-sdk/lib/apiconf-refs';
export * from 'fe-sdk/lib/shared-refs';

export const baseURL = process.env.API_URL || '';

export const apiType = 'user';
export const apiURL = baseURL + `/api/${apiType}`;

const axiosInstance = axios.create({
  baseURL: apiURL,
  headers: {},
});

axiosInstance.interceptors.response.use(
  (res) => res,
  (error: AxiosError) => {
    throw new Error((error?.response?.data as { msg: string })?.msg || error?.message);
  }
);

setAxiosInstance(axiosInstance);
setHandler(axiosHandler);
```

ä¸Šé¢ä½¿ç”¨çš„æ˜¯ `axios`, å¦‚æœä½ æƒ³ä½¿ç”¨ fetchï¼Œå¯ä»¥ä½¿ç”¨ `xior` [æŸ¥çœ‹](/docs/guide/tsdk-server-adapters/express-adapter#å‰ç«¯ä½¿ç”¨-xior-åŸºäº-fetch)

#### åˆ›å»º hook

```ts filename="next-app/app/useHello.ts" copy
'use client';
import { useState, useEffect } from 'react';
import { GetHello, UpdateHello, UpdateHelloReq } from '@/lib/user-api';

export function useHello() {
  const [hello, setHello] = useState('');

  useEffect(() => {
    GetHello({}).then((res) => {
      setHello(res.result);
    });
  }, []);

  async function update(payload: UpdateHelloReq['payload']) {
    const res = await UpdateHello({ payload });
    setHello(res.result);
  }

  return {
    hello,
    update,
  };
}
```

<Callout type="error" emoji="ï¸ğŸš«">
  å¯¼å…¥ API ä¸èƒ½ç›´æ¥è¿™æ ·å†™ 
  ```ts 
  import { GetHello, UpdateHello, UpdateHelloReq } from 'fe-sdk/lib/user-api'; 
  ```
</Callout>

<Callout emoji="ï¸âœ…">
  è¿™æ ·å†™å¯ä»¥ï¼š
  ```ts 
  import { GetHello, UpdateHello, UpdateHelloReq } from '@/lib/user-api'; 
  ```

  è¿™æ˜¯å› ä¸ºåœ¨ `@/lib/user-api` é‡Œé¢æˆ‘ä»¬è¿›è¡Œäº†è¯·æ±‚é…ç½®ã€‚
</Callout>

#### æ›´æ–° `app/page.tsx`

```tsx filename="next-app/app/page.tsx" copy
'use client';

import { useHello } from './useHello';

export default function Home() {
  const { hello, update } = useHello();

  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold">{hello}</h1>
      <button
        className="bg-indigo-500 rounded px-2 py-4 text-white"
        onClick={() => {
          update('Hello tsdk!');
        }}>
        Update to `Hello tsdk!`
      </button>
    </div>
  );
}
```

#### è¿è¡Œ

```sh copy
pnpm --filter=next-app dev
```
